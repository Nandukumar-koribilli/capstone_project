<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Review Agent</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-red: #f85149;
            --accent-orange: #d29922;
            --accent-purple: #a371f7;
            --border-color: #30363d;
            --critical: #f85149;
            --high: #d29922;
            --medium: #d29922;
            --low: #58a6ff;
            --info: #8b949e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
        }
        
        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .panel-header {
            padding: 16px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-header h2 {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-body {
            padding: 20px;
        }
        
        textarea {
            width: 100%;
            height: 400px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            color: var(--text-primary);
            resize: vertical;
            line-height: 1.5;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: #4c9aed;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--border-color);
        }
        
        .btn-ai {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            color: white;
        }
        
        .btn-ai:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        select {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 6px;
        }
        
        .results-container {
            display: none;
        }
        
        .results-container.active {
            display: block;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        
        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .summary-card .label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .summary-card.critical .value { color: var(--critical); }
        .summary-card.high .value { color: var(--high); }
        .summary-card.medium .value { color: var(--medium); }
        .summary-card.low .value { color: var(--low); }
        .summary-card.grade-a .value { color: var(--accent-green); }
        .summary-card.grade-b .value { color: var(--accent-blue); }
        .summary-card.grade-c .value { color: var(--accent-orange); }
        .summary-card.grade-d .value { color: var(--high); }
        .summary-card.grade-f .value { color: var(--critical); }
        
        .issues-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .issue-item {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid var(--border-color);
        }
        
        .issue-item.critical { border-left-color: var(--critical); }
        .issue-item.high { border-left-color: var(--high); }
        .issue-item.medium { border-left-color: var(--medium); }
        .issue-item.low { border-left-color: var(--low); }
        .issue-item.info { border-left-color: var(--info); }
        
        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .issue-message {
            font-weight: 500;
            flex: 1;
        }
        
        .issue-badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .issue-badge.critical { background: rgba(248, 81, 73, 0.2); color: var(--critical); }
        .issue-badge.high { background: rgba(210, 153, 34, 0.2); color: var(--high); }
        .issue-badge.medium { background: rgba(210, 153, 34, 0.2); color: var(--medium); }
        .issue-badge.low { background: rgba(88, 166, 255, 0.2); color: var(--low); }
        .issue-badge.info { background: rgba(139, 148, 158, 0.2); color: var(--info); }
        
        .issue-meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }
        
        .issue-suggestion {
            margin-top: 8px;
            padding: 8px 12px;
            background: rgba(88, 166, 255, 0.1);
            border-radius: 4px;
            font-size: 0.9rem;
            color: var(--accent-blue);
        }
        
        .ai-suggestions {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .ai-suggestions h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            color: var(--accent-purple);
        }
        
        .ai-content {
            font-size: 0.95rem;
            line-height: 1.7;
        }
        
        .ai-content pre {
            background: var(--bg-primary);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
        }
        
        .ai-content code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .metric-item {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
        }
        
        .metric-item .label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .metric-item .value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 4px;
        }
        
        .tab {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px 6px 0 0;
            font-size: 14px;
            font-weight: 500;
        }
        
        .tab.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }
        
        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 40px;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <header>
        <h1>&#129302; AI Code Review Agent</h1>
        <p>Multi-agent code analysis with security scanning, quality metrics, and AI-powered suggestions</p>
    </header>
    
    <div class="container">
        <div class="main-grid">
            <!-- Input Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2>&#128221; Code Input</h2>
                    <select id="language-select">
                        <option value="auto">Auto-detect</option>
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="typescript">TypeScript</option>
                        <option value="java">Java</option>
                        <option value="go">Go</option>
                    </select>
                </div>
                <div class="panel-body">
                    <textarea id="code-input" placeholder="Paste your code here...

# Example Python code:
import os

def run_command(cmd):
    os.system(cmd)  # Security issue!
    return True

password = 'secret123'  # Hardcoded password!
"></textarea>
                    <div class="controls">
                        <button class="btn-primary" id="review-btn">
                            &#128269; Review Code
                        </button>
                        <button class="btn-ai" id="review-ai-btn">
                            &#10024; Review with AI
                        </button>
                        <button class="btn-secondary" id="sample-btn">
                            &#128203; Load Sample
                        </button>
                        <button class="btn-secondary" id="clear-btn">
                            &#128465; Clear
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Results Panel -->
            <div class="panel">
                <div class="panel-header">
                    <h2>&#128202; Review Results</h2>
                    <span id="execution-time" style="color: var(--text-secondary); font-size: 0.85rem;"></span>
                </div>
                <div class="panel-body">
                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <p>Analyzing code...</p>
                    </div>
                    
                    <div class="empty-state" id="empty-state">
                        <div class="icon">&#128269;</div>
                        <p>Paste your code and click "Review Code" to start analysis</p>
                    </div>
                    
                    <div class="results-container" id="results">
                        <div class="summary-cards" id="summary-cards"></div>
                        
                        <div class="tabs">
                            <button class="tab active" data-tab="issues">Issues</button>
                            <button class="tab" data-tab="metrics">Metrics</button>
                            <button class="tab" data-tab="ai" id="ai-tab" style="display: none;">AI Suggestions</button>
                        </div>
                        
                        <div class="tab-content active" id="issues-tab">
                            <div class="issues-list" id="issues-list"></div>
                        </div>
                        
                        <div class="tab-content" id="metrics-tab">
                            <div class="metrics-grid" id="metrics-grid"></div>
                        </div>
                        
                        <div class="tab-content" id="ai-tab-content">
                            <div class="ai-suggestions" id="ai-suggestions"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>Built with Flask, Python AST, and Google Gemini AI | Multi-Agent Architecture</p>
    </footer>
    
    <script>
        const sampleCode = `import os
import pickle

def run_command(cmd):
    os.system(cmd)  # Security issue!
    return True

def load_data(filename):
    with open(filename, 'rb') as f:
        return pickle.load(f)  # Unsafe deserialization

password = "super_secret_123"  # Hardcoded password!

def process_input():
    user_input = input("Enter command: ")
    eval(user_input)  # Critical security issue!

def calculate(a, b, c, d, e, f=[]):  # Mutable default argument
    if a > 0:
        if b > 0:
            if c > 0:
                if d > 0:
                    return a + b + c + d
    return 0

from os import *  # Star import
`;
        
        // Event listeners
        document.getElementById('sample-btn').addEventListener('click', function() {
            document.getElementById('code-input').value = sampleCode;
        });
        
        document.getElementById('clear-btn').addEventListener('click', function() {
            document.getElementById('code-input').value = '';
            document.getElementById('results').classList.remove('active');
            document.getElementById('empty-state').style.display = 'block';
            document.getElementById('execution-time').textContent = '';
        });
        
        document.getElementById('review-btn').addEventListener('click', function() {
            reviewCode(false);
        });
        
        document.getElementById('review-ai-btn').addEventListener('click', function() {
            reviewCode(true);
        });
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(function(tab) {
            tab.addEventListener('click', function() {
                var tabName = this.getAttribute('data-tab');
                
                document.querySelectorAll('.tab').forEach(function(t) {
                    t.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(function(t) {
                    t.classList.remove('active');
                });
                
                this.classList.add('active');
                var tabContent = document.getElementById(tabName + '-tab' + (tabName === 'ai' ? '-content' : ''));
                if (tabContent) {
                    tabContent.classList.add('active');
                }
            });
        });
        
        async function reviewCode(includeAI) {
            var code = document.getElementById('code-input').value;
            var language = document.getElementById('language-select').value;
            
            if (!code.trim()) {
                alert('Please enter some code to review');
                return;
            }
            
            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('empty-state').style.display = 'none';
            document.getElementById('results').classList.remove('active');
            
            try {
                var response = await fetch('/api/review', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: code,
                        language: language === 'auto' ? null : language,
                        include_ai: includeAI
                    })
                });
                
                var data = await response.json();
                
                if (data.error) {
                    alert('Error: ' + data.error);
                    return;
                }
                
                displayResults(data);
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                document.getElementById('loading').classList.remove('active');
            }
        }
        
        function displayResults(data) {
            document.getElementById('results').classList.add('active');
            document.getElementById('execution-time').textContent = 'Time: ' + data.execution_time + 's';
            
            // Summary cards
            var summary = data.summary;
            var summaryHTML = '<div class="summary-card ' + summary.risk_level.toLowerCase() + '">' +
                '<div class="value">' + summary.total_issues + '</div>' +
                '<div class="label">Total Issues</div>' +
                '</div>' +
                '<div class="summary-card critical">' +
                '<div class="value">' + summary.by_severity.critical + '</div>' +
                '<div class="label">Critical</div>' +
                '</div>' +
                '<div class="summary-card high">' +
                '<div class="value">' + summary.by_severity.high + '</div>' +
                '<div class="label">High</div>' +
                '</div>' +
                '<div class="summary-card grade-' + summary.quality_grade.toLowerCase() + '">' +
                '<div class="value">' + summary.quality_grade + '</div>' +
                '<div class="label">Quality Grade</div>' +
                '</div>';
            document.getElementById('summary-cards').innerHTML = summaryHTML;
            
            // Issues list
            var issuesHTML = '';
            if (data.issues.length > 0) {
                data.issues.forEach(function(issue) {
                    issuesHTML += '<div class="issue-item ' + issue.severity_class + '">' +
                        '<div class="issue-header">' +
                        '<span class="issue-message">' + issue.icon + ' ' + escapeHtml(issue.message) + '</span>' +
                        '<span class="issue-badge ' + issue.severity_class + '">' + issue.severity + '</span>' +
                        '</div>' +
                        '<div class="issue-meta">' +
                        (issue.line_number ? 'Line ' + issue.line_number : '') +
                        ' | Category: ' + issue.category +
                        (issue.code_snippet ? '<br><code>' + escapeHtml(issue.code_snippet) + '</code>' : '') +
                        '</div>' +
                        (issue.suggestion ? '<div class="issue-suggestion">&#128161; ' + escapeHtml(issue.suggestion) + '</div>' : '') +
                        '</div>';
                });
            } else {
                issuesHTML = '<div class="empty-state"><div class="icon">&#9989;</div><p>No issues found! Your code looks clean.</p></div>';
            }
            document.getElementById('issues-list').innerHTML = issuesHTML;
            
            // Metrics
            var metrics = data.metrics;
            var metricsHTML = '<div class="metric-item">' +
                '<div class="label">Lines of Code</div>' +
                '<div class="value">' + metrics.lines_of_code + '</div>' +
                '</div>' +
                '<div class="metric-item">' +
                '<div class="label">Cyclomatic Complexity</div>' +
                '<div class="value">' + metrics.cyclomatic_complexity + '</div>' +
                '</div>' +
                '<div class="metric-item">' +
                '<div class="label">Cognitive Complexity</div>' +
                '<div class="value">' + metrics.cognitive_complexity + '</div>' +
                '</div>' +
                '<div class="metric-item">' +
                '<div class="label">Maintainability Index</div>' +
                '<div class="value">' + metrics.maintainability_index + '/100</div>' +
                '</div>' +
                '<div class="metric-item">' +
                '<div class="label">Functions</div>' +
                '<div class="value">' + metrics.function_count + '</div>' +
                '</div>' +
                '<div class="metric-item">' +
                '<div class="label">Classes</div>' +
                '<div class="value">' + metrics.class_count + '</div>' +
                '</div>' +
                '<div class="metric-item">' +
                '<div class="label">Max Nesting Depth</div>' +
                '<div class="value">' + metrics.nesting_depth + '</div>' +
                '</div>' +
                '<div class="metric-item">' +
                '<div class="label">Quality Grade</div>' +
                '<div class="value">' + metrics.grade + '</div>' +
                '</div>';
            document.getElementById('metrics-grid').innerHTML = metricsHTML;
            
            // AI Suggestions
            if (data.ai_suggestions) {
                document.getElementById('ai-tab').style.display = 'block';
                document.getElementById('ai-suggestions').innerHTML = '<h3>&#129302; AI-Powered Suggestions</h3>' +
                    '<div class="ai-content">' + formatMarkdown(data.ai_suggestions) + '</div>';
            } else {
                document.getElementById('ai-tab').style.display = 'none';
            }
        }
        
        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function formatMarkdown(text) {
            // Simple markdown formatting - avoiding regex issues
            var result = text;
            
            // Code blocks
            result = result.replace(/```[\w]*\n([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
            
            // Inline code
            result = result.replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // Bold
            result = result.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            
            // Italic
            result = result.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            
            // Headers
            result = result.replace(/^### (.+)$/gm, '<h4>$1</h4>');
            result = result.replace(/^## (.+)$/gm, '<h3>$1</h3>');
            result = result.replace(/^# (.+)$/gm, '<h2>$1</h2>');
            
            // Line breaks
            result = result.replace(/\n/g, '<br>');
            
            return result;
        }
    </script>
</body>
</html>